/* @license MIT LICENSE https://github.com/grenouille220/jquery-musketeer/blob/master/LICENSE */
!function(t,n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof exports?module.exports=n(require("jquery")):t.musketeer=n(t.jQuery)}(this,function($){function t(t){this.init()}function n(t){var n=t.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0];return $("<head />").html($.parseHTML(n,document,!0))}function e(t){var n=t.replace(/(\r\n|\n|\r)/gm,"").replace(/([^]+<body[^>]*>|<\/body>[^]+)/g);return $("<div />").html($.parseHTML(n,document,!0))}return t.defaults={debug:"0",i18n:{},barbajs:{head:["meta[name='keywords']","meta[name='description']","meta[property^='og']","meta[name^='twitter']","meta[itemprop]","link[itemprop]","link[rel='prev']","link[rel='next']","link[rel='canonical']","script[ lang ]"].join(",")}},t.prototype.log=function(){},t.prototype.init=function(){var t=this;$(document).ready(function(){var n=$("#musketeer-setting");n.length?t.options=$.extend(!0,t.constructor.defaults,JSON.parse(n.html())):t.options&&(t.options=$.extend(!0,t.constructor.defaults,t.options)),parseInt(t.debug||"",10),!isNaN(t.options.debug)&&t.options.debug>0&&(t.log=function(t,n){1===arguments.length?window.console&&window.console.log&&window.console.log(arguments[0]):window.console&&window.console[t]&&window.console[t]("jQuery Musketeer: "+n)}),t.lang=$.jStorage.get("lang",t.options.i18n.base),t.getRemoteData(),t.pjaxify()})},t.prototype.urlfaker=function(t){var n=this;n.log("info","urlfaker("+(t||"")+")");var e=window.location.protocol,a=window.location.host,o="",i="",r="";return t?(o=t.replace(e+"//"+a,""),o=o.replace(/\?.*/,""),o=o.replace(/#.*/,""),/\?/.test(t)&&(i="?"+t.split("?")[1].split("#")[0]),/#/.test(t)&&(r="#"+t.split("#")[1])):(t=document.location.href,o=window.location.pathname,i=window.location.search,r=window.location.hash),$.each(n.options.i18n.langs,function(){o=o.replace(new RegExp("^/"+this.toString()+"/"),"/")}),/lang/.test(i||"")&&(i=i.replace(/lang\=[a-zA-Z-_]+/,""),i.length<2&&(i="")),$.inArray((r||"").replace("#",""),n.options.i18n.langs)>-1&&(r=""),n.lang!==n.options.i18n.base&&(a+="/"+n.lang),t=[window.location.protocol,"//",a,o,i,r].join(""),n.log("The following url was generated:"+t),t},t.prototype.triggerLang=function(t){$(this.options.i18n.menu).find("a[ lang='"+t+"' ],a[ hreflang='"+t+"' ]").trigger("click")},t.prototype.pjaxify=function(){var t=this,e=document.documentElement||{};if(!window.Barba||!this.options.barbajs)return!1;Barba.Pjax.cacheEnabled=!1;var a=!0,o=document.location.href;$.each(t.options.i18n.langs,function(){o=o.replace(new RegExp("/"+this.toString()+"/"),"/")}),Barba.Dispatcher.on("linkClicked",function(t,n){a=!0}),Barba.Pjax.getCurrentUrl=function(){if(t.log("info","Barba.Pjax.getCurrentUrl()"),!a){t.log("warn","URL requested from browser back / next buttons");var n=window.location.pathname,e=0,i;$.each(t.options.i18n.langs,function(){i=new RegExp("^/"+this.toString()+"/"),!e&&i.test(n)&&new RegExp(n.replace(i,"/")).test(o)&&(e=1,t.triggerLang(this.toString()))}),!e&&new RegExp(window.location.pathname).test(o)&&(e=1,t.triggerLang(t.options.i18n.base)),e||(e=1,o=[window.location.protocol,"//",window.location.host,n,window.location.search,window.hash].join(""))}return o},Barba.Pjax.goTo=function(n){t.log("info","Barbar.Pjax.goTo("+n+")"),o=n,Barba.Pjax.onStateChange(),window.history.pushState(null,null,t.urlfaker(n)),a=!1},Barba.Pjax.start(),a=!1,Barba.Dispatcher.on("newPageReady",function(a,o,i,r){var l=n(r),s=t.options.barbajs.head;$("head").find(s).remove(),l.find(s).appendTo("head");var c=e.lang||"en";t.triggerLang(c),window.ga&&window.ga("send","pageview",window.location.pathname+window.location.search)})},t.prototype.i18n=function(){if(!this.options||!this.options.i18n)return!1;if(!this.options.i18n.langs||!this.options.i18n.langs.length)return!1;var t=function(){var t=$("."+Barba.Pjax.Dom.containerClass),n=window.twttr||!1;n&&n.widgets.load(t[t.length-1])},n=this,e=document.documentElement||{};e.lang=e.lang||"en";var a=function(a){n.log("info","Switching Language to "+a),n.lang=a,$.jStorage.set("lang",a);var o=$("body");o.hasClass(n.lang)||(o.removeClass(e.lang),e.lang=n.lang,o.addClass(n.lang));var i=n.urlfaker();i!==document.location.href&&window.history.pushState(null,null,i);var r=$("#head-"+a);if(r.length){var l=JSON.parse(r.html()),s=$("head");$("head").find(n.options.barbajs.head).filter(":not( script )").remove();for(var c in l)if(l.hasOwnProperty(c))if(/title/.test(c))document.title=l[c];else for(var h=l[c],g=0,d,p,u=h.length;g<u;g++){p=h[g],d="<"+c;for(var f in p)d+=" "+f+'="'+p[f]+'"';d+=">",s.append(d)}}$.each(n.options.i18n.langs,function(){a=this.toString(),a!==n.lang&&o.find(n.options.i18n.selector.replace("%lang",a)).each(function(){var t=$(this);t.length&&(/script/.test((t[0].tagName||"").toLowerCase())||($(this).children().length&&$(this).data("cached",$(this).html()),$(this).empty().css("display","none")))})}),o.find(n.options.i18n.selector.replace("%lang",n.lang)).each(function(){var t=$(this);if(t.length)if(/script/.test((t[0].tagName||"").toLowerCase())){var n=JSON.parse(t.html());n&&n.id&&n.content&&$("#"+n.id).html($("<textarea/>").html(n.content).text()).data("cached",null)}else!t.children().length&&t.data("cached")&&t.html(t.data("cached")).css("display","block").data("cached",null)}),t(),$(document).trigger("musketeer:ready")};if(this.options.i18n.menu){var o=$(this.options.i18n.menu);o.find("a").bind("click",function(t){t.preventDefault(),a($(this).attr("hreflang")||$(this).attr("lang")),o.find(".ui-state-active").removeClass("ui-state-active"),$(this).addClass("ui-state-active")})}var i=[];i=/lang/.test(document.location.href)?document.location.href.match(/lang\=([a-zA-Z_-]+)/):window.location.hash&&window.location.hash.length>1?window.location.hash.match(/\#([a-zA-Z_-]+)/):window.location.pathname.match(/^\/([a-zA-Z_-]+)\//),i&&i.length&&i[1]&&$.inArray(i[1],this.options.i18n.langs)>-1?n.triggerLang(i[1]):a($.jStorage.get("lang",e.lang))},t.prototype.getRemoteData=function(){var t=this,a=$("[data-remote]"),o=a.length;return o<1?(t.i18n(),1):void a.each(function(){var a=$(this),i=a.attr("id")||!1;i?(Barba.Utils.xhr(a.attr("data-remote")).then(function(a){o--,$(this).html($(e(a)).find("#"+i).html());var r=$(n(a)).find("script[lang]");r.length&&($("#"+r.attr("id")).remove(),$("head").append(r)),o<1&&t.i18n()},function(n){t.log(n.message)}),a.removeAttr("data-remote")):(t.log("warn","Missing id attribute on el"+a),a.remove())})},new t});
//# sourceMappingURL=./jquery-musketeer.min.js.map